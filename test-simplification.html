<!DOCTYPE html>
<html>
<head>
  <title>Porovn√°n√≠ - Origin√°ln√≠ vs Zjednodu≈°en√° trasa</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <style>
    body { margin: 0; padding: 0; font-family: Arial, sans-serif; }
    #map { height: 70vh; }
    #controls { padding: 20px; background: #f0f0f0; }
    .info { padding: 10px; background: white; margin: 10px 0; border-radius: 5px; }
    .stats { display: flex; gap: 20px; flex-wrap: wrap; }
    .stat-box { background: white; padding: 15px; border-radius: 5px; min-width: 150px; }
    .stat-label { font-size: 12px; color: #666; }
    .stat-value { font-size: 24px; font-weight: bold; color: #333; }
    input[type="range"] { width: 300px; }
    .legend { padding: 10px; background: white; border-radius: 5px; }
    .legend-item { display: flex; align-items: center; gap: 10px; margin: 5px 0; }
    .legend-line { width: 30px; height: 3px; }
  </style>
</head>
<body>
  <div id="map"></div>
  <div id="controls">
    <div class="info">
      <h2>Silnice 214 Kerlingardalsvegur - Porovn√°n√≠ p≈ôesnosti</h2>
      <p>üî¥ ƒåerven√° = Origin√°ln√≠ trasa (453 bod≈Ø, 9,411 znak≈Ø)</p>
      <p>üîµ Modr√° = Zjednodu≈°en√° trasa (Douglas-Peucker algoritmus)</p>
    </div>

    <div class="legend">
      <label><strong>Tolerance (p≈ôesnost):</strong> <span id="toleranceValue">0.0001</span>¬∞</label><br>
      <input type="range" id="tolerance" min="1" max="100" value="10" step="1">
      <p style="font-size: 12px; color: #666;">‚Üê Vy≈°≈°√≠ p≈ôesnost (v√≠ce bod≈Ø) | Ni≈æ≈°√≠ p≈ôesnost (m√©nƒõ bod≈Ø) ‚Üí</p>
    </div>

    <div class="stats">
      <div class="stat-box">
        <div class="stat-label">Origin√°ln√≠ body</div>
        <div class="stat-value" id="originalPoints">-</div>
      </div>
      <div class="stat-box">
        <div class="stat-label">Zjednodu≈°en√© body</div>
        <div class="stat-value" id="simplifiedPoints">-</div>
      </div>
      <div class="stat-box">
        <div class="stat-label">√öspora</div>
        <div class="stat-value" id="saving">-</div>
      </div>
      <div class="stat-box">
        <div class="stat-label">Maxim√°ln√≠ odchylka</div>
        <div class="stat-value" id="maxError">-</div>
      </div>
    </div>
  </div>

  <script>
    // Origin√°ln√≠ data ze silnice 214
    const originalCoords = [[63.42432,-18.90362],[63.42436,-18.90365],[63.42444,-18.90371],[63.42471,-18.90423],[63.42488,-18.90455],[63.42505,-18.90491],[63.42514,-18.90511],[63.42522,-18.90535],[63.42536,-18.90573],[63.42541,-18.90591],[63.42559,-18.90654],[63.4258,-18.9072],[63.42606,-18.90783],[63.42619,-18.90804],[63.42633,-18.90827],[63.42658,-18.90862],[63.42673,-18.90879],[63.42705,-18.90906],[63.4274,-18.90922],[63.42766,-18.90926],[63.42794,-18.90926],[63.42827,-18.90917],[63.42862,-18.90906],[63.42912,-18.90894],[63.4298,-18.90899],[63.43083,-18.90944],[63.43128,-18.90954],[63.43165,-18.90948],[63.43206,-18.90935],[63.43241,-18.90907],[63.43283,-18.90863],[63.43311,-18.90824],[63.43336,-18.90783],[63.43413,-18.90612],[63.43457,-18.90529],[63.43521,-18.90452],[63.43551,-18.90431],[63.43579,-18.90416],[63.43606,-18.90405],[63.43636,-18.90402],[63.43705,-18.90406],[63.43795,-18.9041],[63.43917,-18.90414],[63.43925,-18.90415],[63.43958,-18.90418],[63.44063,-18.90423],[63.44153,-18.90429],[63.44232,-18.90435],[63.44278,-18.90436],[63.44293,-18.90434],[63.44299,-18.90432],[63.44304,-18.90428],[63.44309,-18.9042],[63.44315,-18.90406],[63.4432,-18.90388],[63.44327,-18.90361],[63.44337,-18.90324],[63.44346,-18.90288],[63.44428,-18.9003],[63.44449,-18.89974],[63.44469,-18.8993],[63.44491,-18.89885],[63.44514,-18.89838],[63.44521,-18.89825],[63.44566,-18.89732],[63.44577,-18.89705],[63.44584,-18.89677],[63.4459,-18.89648],[63.44598,-18.89603],[63.44603,-18.89558],[63.44605,-18.89526],[63.44605,-18.89492],[63.44605,-18.89392],[63.44604,-18.89357],[63.44606,-18.8933],[63.44611,-18.89302],[63.44617,-18.89273],[63.44635,-18.89211],[63.4467,-18.89094],[63.44687,-18.89033],[63.44702,-18.88987],[63.44713,-18.88972],[63.44735,-18.88946],[63.44753,-18.88917],[63.44757,-18.88896],[63.44756,-18.8887],[63.44747,-18.88819],[63.44744,-18.88784],[63.44738,-18.88718],[63.44724,-18.88624],[63.44721,-18.88591],[63.44721,-18.88556],[63.44725,-18.88525],[63.44732,-18.88494],[63.4483,-18.88152],[63.449,-18.87911],[63.44923,-18.87834],[63.44952,-18.87739],[63.44958,-18.87721],[63.44975,-18.8767],[63.44984,-18.87652],[63.45008,-18.87617],[63.45085,-18.8755],[63.45101,-18.87539],[63.45122,-18.87528],[63.45143,-18.87527],[63.45161,-18.8753],[63.45192,-18.87558],[63.4524,-18.876],[63.45255,-18.87603],[63.45292,-18.87584],[63.45323,-18.87547],[63.45338,-18.87521],[63.45368,-18.87472],[63.45394,-18.87425],[63.45525,-18.87198],[63.45579,-18.87117],[63.45629,-18.87071],[63.45655,-18.87058],[63.45697,-18.87044],[63.45742,-18.87027],[63.45775,-18.87027],[63.4579,-18.87033],[63.45807,-18.87048],[63.45836,-18.87078],[63.45858,-18.87108],[63.45883,-18.87138],[63.45913,-18.87181],[63.45948,-18.87237],[63.45971,-18.87294],[63.45991,-18.87348],[63.46004,-18.87391],[63.46017,-18.87436],[63.46042,-18.87499],[63.46055,-18.87524],[63.46079,-18.8756],[63.46106,-18.8759],[63.46132,-18.87602],[63.46176,-18.87606],[63.46222,-18.87597],[63.46267,-18.87608],[63.46325,-18.87619],[63.46342,-18.87619],[63.46362,-18.87633],[63.4639,-18.8767],[63.46416,-18.87739],[63.46434,-18.87822],[63.46437,-18.8785],[63.46445,-18.87928],[63.46446,-18.87998],[63.46441,-18.88082],[63.4644,-18.88152],[63.46437,-18.88185],[63.46433,-18.88243],[63.4643,-18.88276],[63.4641,-18.88356],[63.464,-18.88401],[63.46394,-18.88455],[63.46394,-18.8849],[63.46398,-18.88524],[63.46403,-18.88554],[63.46416,-18.88597],[63.46442,-18.88679],[63.46471,-18.88756],[63.4648,-18.88773],[63.46489,-18.88794],[63.46525,-18.88822],[63.46544,-18.8883],[63.4657,-18.8884],[63.46611,-18.88869],[63.46646,-18.88905],[63.46679,-18.88931],[63.46697,-18.88938],[63.46733,-18.88941],[63.46749,-18.88969],[63.46759,-18.88995],[63.46768,-18.89041],[63.46768,-18.89066],[63.46766,-18.89084],[63.46752,-18.89146],[63.46751,-18.8917],[63.46753,-18.89193],[63.46758,-18.89217],[63.46762,-18.89264],[63.46767,-18.89282],[63.46776,-18.89294],[63.46786,-18.89298],[63.4681,-18.89294],[63.46834,-18.89293],[63.46878,-18.8929],[63.46888,-18.89294],[63.46914,-18.89329],[63.46933,-18.89347],[63.46976,-18.89379],[63.46999,-18.89387],[63.47019,-18.89391],[63.47071,-18.89378],[63.47105,-18.89382],[63.47126,-18.89379],[63.47144,-18.89387],[63.47175,-18.89384],[63.47185,-18.89374],[63.47193,-18.89361],[63.47209,-18.89327],[63.47218,-18.8931],[63.4724,-18.8929],[63.47252,-18.89286],[63.47266,-18.89284],[63.47295,-18.89284],[63.47317,-18.89286],[63.47327,-18.89293],[63.47349,-18.89326],[63.47361,-18.89341],[63.47373,-18.89349],[63.47386,-18.8935],[63.47401,-18.89346],[63.47464,-18.89308],[63.47498,-18.89282],[63.47507,-18.89269],[63.47513,-18.89247],[63.47516,-18.89217],[63.47516,-18.89188],[63.47512,-18.89165],[63.47506,-18.89149],[63.47498,-18.89134],[63.47493,-18.89114],[63.47489,-18.8909],[63.4749,-18.89065],[63.47497,-18.89038],[63.47523,-18.88965],[63.47543,-18.88925],[63.47567,-18.88882],[63.47572,-18.88872],[63.47574,-18.88853],[63.47571,-18.88829],[63.47566,-18.8879],[63.47568,-18.88752],[63.47576,-18.88719],[63.47584,-18.88695],[63.47593,-18.88678],[63.47603,-18.88668],[63.47623,-18.88661],[63.47652,-18.88677],[63.47663,-18.88685],[63.47678,-18.88703],[63.47689,-18.88728],[63.47696,-18.88766],[63.47699,-18.88808],[63.47705,-18.88851],[63.47725,-18.8889],[63.47749,-18.8891],[63.47823,-18.88945],[63.48003,-18.89013],[63.48137,-18.89065],[63.48169,-18.89073],[63.48201,-18.8907],[63.48263,-18.89056],[63.48315,-18.8903],[63.48351,-18.88996],[63.48396,-18.88961],[63.48424,-18.88954],[63.48457,-18.88938],[63.48502,-18.88925],[63.48529,-18.88916],[63.48583,-18.88882],[63.48895,-18.88598],[63.48951,-18.88544],[63.48989,-18.88499],[63.49028,-18.88446],[63.49068,-18.88375],[63.49106,-18.88301],[63.4912,-18.8827],[63.49205,-18.88062],[63.49224,-18.88009],[63.49239,-18.87984],[63.49276,-18.8795],[63.49311,-18.87921],[63.49368,-18.87846],[63.49386,-18.87817],[63.49404,-18.87776],[63.49417,-18.87732],[63.49429,-18.87675],[63.49441,-18.87585],[63.4945,-18.87498],[63.49455,-18.8748],[63.49462,-18.8747],[63.49473,-18.87468],[63.49484,-18.87476],[63.49505,-18.87503],[63.49547,-18.87559],[63.49562,-18.87575],[63.49579,-18.87586],[63.496,-18.87581],[63.49624,-18.87556],[63.49644,-18.87525],[63.49701,-18.87399],[63.49755,-18.8728],[63.49766,-18.87244],[63.49785,-18.87111],[63.4979,-18.87072],[63.498,-18.87045],[63.49808,-18.87029],[63.49822,-18.87012],[63.4984,-18.87001],[63.49865,-18.86996],[63.49902,-18.86992],[63.49941,-18.86998],[63.49996,-18.87006],[63.50048,-18.87004],[63.50115,-18.8697],[63.50181,-18.86915],[63.50204,-18.86893],[63.50228,-18.86854],[63.50236,-18.86834],[63.50269,-18.86752],[63.50308,-18.86596],[63.50309,-18.8654],[63.50297,-18.86495],[63.50268,-18.86439],[63.50183,-18.8633],[63.50181,-18.86317],[63.50187,-18.86304],[63.50196,-18.86299],[63.50234,-18.8629],[63.50268,-18.86283],[63.50332,-18.8629],[63.50358,-18.86271],[63.50368,-18.86258],[63.50385,-18.86221],[63.50401,-18.86175],[63.50411,-18.86141],[63.50421,-18.86089],[63.50431,-18.86011],[63.50436,-18.8595],[63.50442,-18.85851],[63.50445,-18.85822],[63.5045,-18.85793],[63.50459,-18.85771],[63.50469,-18.85756],[63.50497,-18.85732],[63.50527,-18.85714],[63.50574,-18.85727],[63.50622,-18.85752],[63.50635,-18.85757],[63.50645,-18.85762],[63.50653,-18.85775],[63.50688,-18.8586],[63.50719,-18.85913],[63.50792,-18.86016],[63.50864,-18.86119],[63.50888,-18.86153],[63.50956,-18.86262],[63.50999,-18.86334],[63.51021,-18.86359],[63.5105,-18.86384],[63.51097,-18.86426],[63.51132,-18.8646],[63.51186,-18.86506],[63.51233,-18.86546],[63.5128,-18.86579],[63.51318,-18.8661],[63.51354,-18.8664],[63.51388,-18.86665],[63.51405,-18.86675],[63.51418,-18.86683],[63.51437,-18.86683],[63.51459,-18.8668],[63.51517,-18.8667],[63.51526,-18.86673],[63.51535,-18.86677],[63.51536,-18.86678],[63.51543,-18.86683],[63.51549,-18.86689],[63.51555,-18.86696],[63.51561,-18.86706],[63.51567,-18.86716],[63.51573,-18.86728],[63.51578,-18.8674],[63.51583,-18.86754],[63.51612,-18.86876],[63.5162,-18.86946],[63.51628,-18.86997],[63.51639,-18.87045],[63.51662,-18.8711],[63.51689,-18.87149],[63.517,-18.87172],[63.51723,-18.87221],[63.51746,-18.8728],[63.51765,-18.87339],[63.51778,-18.87392],[63.51828,-18.87555],[63.51864,-18.87692],[63.51891,-18.8775],[63.51916,-18.87808],[63.51931,-18.87876],[63.51943,-18.87916],[63.51967,-18.87971],[63.51981,-18.88026],[63.51997,-18.88091],[63.52013,-18.88165],[63.52018,-18.88193],[63.5203,-18.88225],[63.52047,-18.88233],[63.52066,-18.88238],[63.52112,-18.88207],[63.52134,-18.882],[63.52155,-18.88199],[63.52186,-18.88214],[63.52258,-18.88255],[63.52325,-18.88293],[63.52362,-18.88307],[63.52381,-18.88312],[63.52508,-18.88331],[63.52518,-18.88332],[63.52527,-18.88333],[63.52533,-18.88336],[63.5254,-18.8834],[63.52545,-18.88344],[63.52553,-18.88356],[63.52567,-18.88373],[63.52571,-18.88376],[63.52575,-18.88379],[63.52578,-18.8838],[63.52581,-18.88379],[63.52583,-18.88378],[63.52592,-18.88373],[63.5261,-18.8836],[63.52626,-18.88352],[63.52647,-18.88341],[63.52675,-18.88323],[63.52739,-18.88288],[63.52782,-18.88257],[63.52794,-18.8825],[63.52807,-18.88236],[63.52827,-18.8823],[63.52841,-18.88224],[63.52851,-18.88219],[63.52858,-18.88217],[63.52864,-18.88217],[63.52869,-18.8822],[63.52874,-18.88224],[63.52878,-18.88228],[63.52883,-18.88234],[63.52889,-18.88244],[63.52901,-18.88265],[63.52909,-18.88284],[63.52936,-18.88373],[63.52966,-18.88465],[63.52996,-18.88572],[63.53012,-18.88642],[63.53026,-18.88706],[63.53035,-18.88755]];

    // Douglas-Peucker simplification algorithm
    function simplifyDouglasPeucker(points, tolerance) {
      if (points.length <= 2) return points;

      // Find the point with maximum distance
      let maxDist = 0;
      let maxIndex = 0;
      const first = points[0];
      const last = points[points.length - 1];

      for (let i = 1; i < points.length - 1; i++) {
        const dist = perpendicularDistance(points[i], first, last);
        if (dist > maxDist) {
          maxDist = dist;
          maxIndex = i;
        }
      }

      // If max distance is greater than tolerance, recursively simplify
      if (maxDist > tolerance) {
        const left = simplifyDouglasPeucker(points.slice(0, maxIndex + 1), tolerance);
        const right = simplifyDouglasPeucker(points.slice(maxIndex), tolerance);
        return left.slice(0, -1).concat(right);
      } else {
        return [first, last];
      }
    }

    function perpendicularDistance(point, lineStart, lineEnd) {
      const [x, y] = point;
      const [x1, y1] = lineStart;
      const [x2, y2] = lineEnd;

      const A = x - x1;
      const B = y - y1;
      const C = x2 - x1;
      const D = y2 - y1;

      const dot = A * C + B * D;
      const lenSq = C * C + D * D;
      let param = -1;

      if (lenSq !== 0) param = dot / lenSq;

      let xx, yy;

      if (param < 0) {
        xx = x1;
        yy = y1;
      } else if (param > 1) {
        xx = x2;
        yy = y2;
      } else {
        xx = x1 + param * C;
        yy = y1 + param * D;
      }

      const dx = x - xx;
      const dy = y - yy;

      return Math.sqrt(dx * dx + dy * dy);
    }

    function calculateMaxError(original, simplified) {
      let maxError = 0;
      for (const point of original) {
        let minDist = Infinity;
        for (let i = 0; i < simplified.length - 1; i++) {
          const dist = perpendicularDistance(point, simplified[i], simplified[i + 1]);
          minDist = Math.min(minDist, dist);
        }
        maxError = Math.max(maxError, minDist);
      }
      // Convert to meters (rough approximation at Iceland's latitude)
      return (maxError * 111000).toFixed(1);
    }

    // Initialize map
    const map = L.map('map').setView([63.475, -18.87], 11);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '¬© OpenStreetMap'
    }).addTo(map);

    let originalLine, simplifiedLine;

    function updateMap() {
      const tolerance = parseFloat(document.getElementById('tolerance').value) / 100000;
      document.getElementById('toleranceValue').textContent = tolerance.toFixed(5);

      const simplified = simplifyDouglasPeucker(originalCoords, tolerance);

      // Remove old lines
      if (originalLine) map.removeLayer(originalLine);
      if (simplifiedLine) map.removeLayer(simplifiedLine);

      // Draw original line (red, thinner, behind)
      originalLine = L.polyline(originalCoords, {
        color: '#ef4444',
        weight: 2,
        opacity: 0.7
      }).addTo(map);

      // Draw simplified line (blue, thicker, on top)
      simplifiedLine = L.polyline(simplified, {
        color: '#3b82f6',
        weight: 4,
        opacity: 0.9
      }).addTo(map);

      // Update stats
      document.getElementById('originalPoints').textContent = originalCoords.length;
      document.getElementById('simplifiedPoints').textContent = simplified.length;
      const saving = ((1 - simplified.length / originalCoords.length) * 100).toFixed(1);
      document.getElementById('saving').textContent = saving + '%';
      document.getElementById('maxError').textContent = calculateMaxError(originalCoords, simplified) + ' m';

      // Fit bounds
      map.fitBounds(originalLine.getBounds());
    }

    // Event listener
    document.getElementById('tolerance').addEventListener('input', updateMap);

    // Initial render
    updateMap();
  </script>
</body>
</html>
