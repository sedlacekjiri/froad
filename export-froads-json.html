<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Export F-roads to JSON</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 { color: #333; margin-bottom: 10px; }
    p { color: #666; line-height: 1.6; }
    button {
      background: #000;
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      margin: 10px 5px;
    }
    button:hover { background: #333; }
    .status {
      margin-top: 20px;
      padding: 15px;
      border-radius: 8px;
      display: none;
    }
    .success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }
    pre {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 6px;
      overflow-x: auto;
      font-size: 12px;
      max-height: 400px;
      overflow-y: auto;
    }
    .instructions {
      background: #fff3cd;
      padding: 20px;
      border-radius: 8px;
      border: 1px solid #ffeeba;
      margin: 20px 0;
    }
    .instructions h3 {
      margin-top: 0;
      color: #856404;
    }
    .instructions ol {
      margin: 10px 0;
      padding-left: 20px;
    }
    .instructions li {
      margin: 8px 0;
      color: #856404;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üì§ Export F-roads Data</h1>
    <p>This tool creates a JSON file that you can import into Firebase Firestore Console.</p>

    <button onclick="generateJSON()">üì• Generate JSON File</button>

    <div id="status" class="status"></div>

    <div class="instructions">
      <h3>üìã How to import to Firebase:</h3>
      <ol>
        <li>Click "Generate JSON File" above</li>
        <li>Save the downloaded <code>froads-firestore.json</code> file</li>
        <li>Go to <a href="https://console.firebase.google.com" target="_blank">Firebase Console</a></li>
        <li>Open your project: <strong>froad-7d561</strong></li>
        <li>Go to <strong>Firestore Database</strong></li>
        <li>Click the <strong>three dots (‚ãÆ)</strong> menu ‚Üí <strong>Import data</strong></li>
        <li>Select your <code>froads-firestore.json</code> file</li>
        <li>Wait for import to complete</li>
        <li>Refresh your explore.html page to see the data!</li>
      </ol>
    </div>

    <div id="preview" style="display:none;">
      <h3>Preview (first 3 items):</h3>
      <pre id="previewContent"></pre>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    function generateJSON() {
      const statusEl = document.getElementById('status');
      statusEl.className = 'status info';
      statusEl.style.display = 'block';
      statusEl.textContent = '‚è≥ Generating JSON...';

      // Hardcoded F-roads data (paste from explore.html)
      const froadDataHardcoded = [
        // This will be filled from explore.html
      ];

      try {
        // Fetch and parse explore.html
        fetch('./explore.html')
          .then(response => response.text())
          .then(html => {
            // Extract froadDataHardcoded array
            const match = html.match(/const froadDataHardcoded = \[([\s\S]*?)\s+\];/);

            if (!match) {
              throw new Error('Could not find froadDataHardcoded in explore.html');
            }

            // Evaluate the array (safe in this context)
            const arrayStr = '[' + match[1] + ']';
            const froadData = eval(arrayStr);

            console.log(`Found ${froadData.length} F-roads`);

            // Convert to Firestore import format
            const firestoreData = {
              "__collections__": {
                "froads": {}
              }
            };

            froadData.forEach((froad, index) => {
              // Create document ID from name
              const docId = froad.name
                .toLowerCase()
                .replace(/[^a-z0-9]/g, '-')
                .replace(/-+/g, '-')
                .replace(/^-|-$/g, '');

              firestoreData.__collections__.froads[docId] = {
                name: froad.name,
                coords: froad.coords,
                photo: froad.photo || '',
                gallery: froad.gallery || [],
                description: froad.description || '',
                difficulty: froad.difficulty || 'Medium',
                lengthKm: froad.lengthKm || 0,
                approxTime: froad.approxTime || '',
                surface: froad.surface || '',
                watchOut: froad.watchOut || '',
                order: index + 1
              };
            });

            // Show preview
            const preview = Object.keys(firestoreData.__collections__.froads).slice(0, 3);
            const previewData = {};
            preview.forEach(key => {
              previewData[key] = firestoreData.__collections__.froads[key];
            });

            document.getElementById('preview').style.display = 'block';
            document.getElementById('previewContent').textContent =
              JSON.stringify({ froads: previewData }, null, 2);

            // Download JSON
            const jsonStr = JSON.stringify(firestoreData, null, 2);
            const blob = new Blob([jsonStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'froads-firestore.json';
            a.click();
            URL.revokeObjectURL(url);

            statusEl.className = 'status success';
            statusEl.textContent = `‚úÖ Downloaded froads-firestore.json (${froadData.length} roads)`;
          })
          .catch(err => {
            statusEl.className = 'status error';
            statusEl.textContent = '‚ùå Error: ' + err.message;
            console.error(err);
          });

      } catch (err) {
        statusEl.className = 'status error';
        statusEl.textContent = '‚ùå Error: ' + err.message;
        console.error(err);
      }
    }
  </script>
</body>
</html>
