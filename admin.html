<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>F-Roads Admin Panel</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: #f9fafb;
      color: #111827;
    }

    /* Auth Screen */
    #authScreen {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .auth-box {
      background: white;
      padding: 40px;
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
      width: 100%;
      max-width: 400px;
    }

    .auth-box h1 {
      margin-bottom: 24px;
      text-align: center;
      font-size: 28px;
    }

    .auth-box input {
      width: 100%;
      padding: 12px 16px;
      margin-bottom: 16px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-size: 14px;
      font-family: 'Poppins', sans-serif;
    }

    .auth-box button {
      width: 100%;
      padding: 12px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }

    .auth-box button:hover {
      background: #5568d3;
    }

    .error-msg {
      color: #dc2626;
      font-size: 14px;
      margin-top: 12px;
      text-align: center;
    }

    /* Admin Panel */
    #adminPanel {
      display: none;
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 40px;
    }

    .header h1 {
      font-size: 32px;
    }

    .logout-btn {
      padding: 10px 20px;
      background: #ef4444;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }

    .logout-btn:hover {
      background: #dc2626;
    }

    .section {
      background: white;
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      margin-bottom: 24px;
    }

    .section h2 {
      font-size: 20px;
      margin-bottom: 20px;
      padding-bottom: 12px;
      border-bottom: 2px solid #e5e7eb;
    }

    /* Update Form */
    .update-form {
      display: grid;
      gap: 16px;
      margin-bottom: 24px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    .form-group label {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 6px;
      color: #374151;
    }

    .form-group select,
    .form-group input,
    .form-group textarea {
      padding: 10px 12px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-size: 14px;
      font-family: 'Poppins', sans-serif;
    }

    .form-group textarea {
      resize: vertical;
      min-height: 80px;
    }

    .btn-primary {
      padding: 12px 24px;
      background: #10b981;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }

    .btn-primary:hover {
      background: #059669;
    }

    /* Updates List */
    .updates-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .update-card {
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 16px;
      transition: box-shadow 0.2s;
    }

    .update-card:hover {
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .update-card-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 8px;
    }

    .update-type-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .type-warning {
      background: #fef3c7;
      color: #92400e;
    }

    .type-info {
      background: #dbeafe;
      color: #1e40af;
    }

    .type-notice {
      background: #e5e7eb;
      color: #374151;
    }

    .update-time {
      font-size: 13px;
      color: #6b7280;
    }

    .update-text {
      color: #111827;
      line-height: 1.6;
      font-size: 14px;
      margin-bottom: 12px;
    }

    .update-actions {
      display: flex;
      gap: 8px;
    }

    .btn-edit, .btn-delete {
      padding: 6px 12px;
      border: none;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-edit {
      background: #f3f4f6;
      color: #374151;
    }

    .btn-edit:hover {
      background: #e5e7eb;
    }

    .btn-delete {
      background: #fee2e2;
      color: #dc2626;
    }

    .btn-delete:hover {
      background: #fecaca;
    }

    .empty-state {
      text-align: center;
      padding: 40px;
      color: #6b7280;
    }

    .loading {
      text-align: center;
      padding: 20px;
      color: #6b7280;
    }
  </style>
</head>
<body>

  <!-- Auth Screen -->
  <div id="authScreen">
    <div class="auth-box">
      <h1>üîí Admin Login</h1>
      <input type="email" id="emailInput" placeholder="Email" />
      <input type="password" id="passwordInput" placeholder="Password" />
      <button id="loginBtn">Login</button>
      <p class="error-msg" id="errorMsg"></p>
    </div>
  </div>

  <!-- Admin Panel -->
  <div id="adminPanel">
    <div class="header">
      <h1>F-Roads Admin Panel</h1>
      <button class="logout-btn" id="logoutBtn">Logout</button>
    </div>

    <!-- Updates Section -->
    <div class="section">
      <h2>üì¢ Updates Management</h2>

      <!-- Add/Edit Form -->
      <form class="update-form" id="updateForm">
        <div class="form-group">
          <label for="updateType">Type</label>
          <select id="updateType" required>
            <option value="warning">‚ö†Ô∏è Warning</option>
            <option value="info">‚ÑπÔ∏è Info</option>
            <option value="notice">üìã Notice</option>
          </select>
        </div>

        <div class="form-group">
          <label for="updateTime">Time (HH:MM, DD.MM.YYYY)</label>
          <input type="text" id="updateTime" placeholder="14:30, 15.11.2025" required />
        </div>

        <div class="form-group">
          <label for="updateText">Message</label>
          <textarea id="updateText" placeholder="Update message..." required></textarea>
        </div>

        <input type="hidden" id="updateId" />
        <button type="submit" class="btn-primary" id="submitBtn">Add Update</button>
      </form>
    </div>

    <!-- Updates List -->
    <div class="section">
      <h2>üìã All Updates</h2>
      <div id="updatesList" class="updates-list">
        <div class="loading">Loading updates...</div>
      </div>
    </div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

  <script>
    // Firebase init
    const config = {
      apiKey: "AIzaSyDDMNnJgtm-gK9OrVev7qmBRpaA8CAoDiM",
      authDomain: "froad-7d561.firebaseapp.com",
      projectId: "froad-7d561",
      storageBucket: "froad-7d561.firebasestorage.app",
      messagingSenderId: "1086299585443",
      appId: "1:1086299585443:web:10bcb67effd6a89c24f816"
    };
    firebase.initializeApp(config);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // DOM elements
    const authScreen = document.getElementById('authScreen');
    const adminPanel = document.getElementById('adminPanel');
    const emailInput = document.getElementById('emailInput');
    const passwordInput = document.getElementById('passwordInput');
    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const errorMsg = document.getElementById('errorMsg');
    const updateForm = document.getElementById('updateForm');
    const updatesList = document.getElementById('updatesList');

    // Auth state
    auth.onAuthStateChanged(async user => {
      if (!user) {
        authScreen.style.display = 'flex';
        adminPanel.style.display = 'none';
        return;
      }

      // Check if user is admin
      try {
        const userDoc = await db.collection('users').doc(user.uid).get();
        const userData = userDoc.data();

        if (userData && userData.admin === true) {
          authScreen.style.display = 'none';
          adminPanel.style.display = 'block';
          loadUpdates();
        } else {
          errorMsg.textContent = 'Access denied. Admin privileges required.';
          await auth.signOut();
        }
      } catch (err) {
        console.error('Error checking admin status:', err);
        errorMsg.textContent = 'Error checking permissions.';
        await auth.signOut();
      }
    });

    // Login
    loginBtn.addEventListener('click', async () => {
      const email = emailInput.value.trim();
      const password = passwordInput.value;

      try {
        await auth.signInWithEmailAndPassword(email, password);
        errorMsg.textContent = '';
      } catch (err) {
        errorMsg.textContent = 'Invalid credentials.';
      }
    });

    // Logout
    logoutBtn.addEventListener('click', () => {
      auth.signOut();
    });

    // Load updates from Firestore
    function loadUpdates() {
      db.collection('updates')
        .orderBy('createdAt', 'desc')
        .onSnapshot(snapshot => {
          if (snapshot.empty) {
            updatesList.innerHTML = '<div class="empty-state">No updates yet. Add your first update!</div>';
            return;
          }

          updatesList.innerHTML = '';
          snapshot.forEach(doc => {
            const update = doc.data();
            const card = createUpdateCard(doc.id, update);
            updatesList.appendChild(card);
          });
        });
    }

    // Create update card
    function createUpdateCard(id, update) {
      const card = document.createElement('div');
      card.className = 'update-card';
      card.innerHTML = `
        <div class="update-card-header">
          <span class="update-type-badge type-${update.type}">${update.type}</span>
          <span class="update-time">${update.time}</span>
        </div>
        <div class="update-text">${update.text}</div>
        <div class="update-actions">
          <button class="btn-edit" onclick="editUpdate('${id}', ${JSON.stringify(update).replace(/'/g, "&#39;")})">Edit</button>
          <button class="btn-delete" onclick="deleteUpdate('${id}')">Delete</button>
        </div>
      `;
      return card;
    }

    // Submit form (Add or Edit)
    updateForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      const updateData = {
        type: document.getElementById('updateType').value,
        time: document.getElementById('updateTime').value,
        text: document.getElementById('updateText').value,
      };

      const updateId = document.getElementById('updateId').value;

      try {
        if (updateId) {
          // Update existing
          await db.collection('updates').doc(updateId).update(updateData);
          console.log('‚úÖ Update updated');
        } else {
          // Add new
          await db.collection('updates').add({
            ...updateData,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
          });
          console.log('‚úÖ Update added');
        }

        // Reset form
        updateForm.reset();
        document.getElementById('updateId').value = '';
        document.getElementById('submitBtn').textContent = 'Add Update';
      } catch (err) {
        console.error('Error saving update:', err);
        alert('Error saving update');
      }
    });

    // Edit update
    window.editUpdate = (id, update) => {
      document.getElementById('updateId').value = id;
      document.getElementById('updateType').value = update.type;
      document.getElementById('updateTime').value = update.time;
      document.getElementById('updateText').value = update.text;
      document.getElementById('submitBtn').textContent = 'Update';
      window.scrollTo({ top: 0, behavior: 'smooth' });
    };

    // Delete update
    window.deleteUpdate = async (id) => {
      if (!confirm('Are you sure you want to delete this update?')) return;

      try {
        await db.collection('updates').doc(id).delete();
        console.log('‚úÖ Update deleted');
      } catch (err) {
        console.error('Error deleting update:', err);
        alert('Error deleting update');
      }
    };
  </script>
</body>
</html>
